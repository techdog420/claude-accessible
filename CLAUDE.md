# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Purpose

This repository contains accessibility wrapper scripts for Claude Code, designed for screen reader users. The scripts avoid interactive terminal prompts that can crash screen readers by auto-approving safe tools and maintaining linear, screen-reader-friendly output.

## Architecture

### Core Components

1. **Wrapper Scripts**
   - `claude-accessible.bat` (Windows)
   - `claude-accessible.sh` (Linux/Mac)
   - Both implement identical functionality with platform-specific syntax

2. **Session Management**
   - `.claude-session` - Stores current session ID for conversation continuity
   - Session IDs enable resuming conversations with `--resume` flag

3. **History Logging**
   - `claude-history.txt` - Linear log of all prompts and responses
   - Includes timestamps for each interaction
   - Screen reader users can review this file independently

### Script Behavior

**Auto-Approval**: Scripts pre-approve these tools to avoid interactive prompts:
- Read, Write, Edit, Bash, Grep, Glob, Task

**Modes**:
- Default mode: Start new or auto-continue based on `.claude-session` existence
- `--continue` / `-c`: Explicitly continue existing session
- `--new` / `-n`: Start fresh, deleting `.claude-session`

**Flow**:
1. Parse command-line arguments for mode and prompt
2. Log prompt with timestamp to history file
3. If session exists and not --new mode: Resume with --resume flag
4. If new session: Use `--output-format json` to capture UUID session ID, save to `.claude-session`
5. Pipe output to both terminal and history file

### Session ID Extraction

- Both scripts use `--output-format json` when starting new sessions
- Session IDs are UUIDs generated by Claude Code (e.g., `77ce4369-b640-4cd4-81cc-6b009bac102c`)
- Windows script uses PowerShell's `ConvertFrom-Json` to parse JSON output
- Linux/Mac script uses `grep` and `sed` to extract session ID from JSON

## Commands

### Running the Scripts

**Windows:**
```
claude-accessible.bat "your prompt here"
claude-accessible.bat --continue "follow-up question"
claude-accessible.bat --new "start fresh"
```

**Linux/Mac:**
```
./claude-accessible.sh "your prompt here"
./claude-accessible.sh --continue "follow-up question"
./claude-accessible.sh --new "start fresh"
```

### Modifying Auto-Approved Tools

Edit the `ALLOWED_TOOLS` variable in either script:
```batch
set ALLOWED_TOOLS=Read,Write,Edit,Bash,Grep,Glob,Task
```

## Key Considerations

When modifying these scripts:
- Maintain linear output flow (no interactive prompts)
- All user communication must be loggable to history file
- Session persistence is critical for conversation continuity
- Quote handling in batch files requires special care with `%~1` syntax
- Test with screen readers to verify accessibility
